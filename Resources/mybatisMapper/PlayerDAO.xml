<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="link.swsk33web.miyakogame.dao.PlayerDAO">
	<resultMap id="playerResultMap"
		type="link.swsk33web.miyakogame.dataobject.PlayerDO">
		<id column="user_name" property="userName" />
		<result column="nickname" property="nickname" />
		<result column="avatar" property="avatar" />
		<result column="high_score" property="highScore" />
		<result column="pwd" property="pwd" />
		<result column="game_data" property="gameData" />
		<result column="gmt_created" property="gmtCreated" />
		<result column="gmt_modified" property="gmtModified" />
	</resultMap>

	<resultMap id="rankResultMap"
		type="link.swsk33web.miyakogame.dataobject.RankInfoDO">
		<id column="user_name" property="userName" />
		<result column="nickname" property="nickname" />
		<result column="avatar" property="avatar" />
		<result column="high_score" property="highScore" />
		<result column="sequence" property="sequence" />
	</resultMap>

	<insert id="add"
		parameterType="link.swsk33web.miyakogame.dataobject.PlayerDO">
		insert into `miyakogame_user`
		(user_name, nickname,
		avatar, high_score, pwd, game_data, gmt_created, gmt_modified)
		values
		(#{userName}, #{nickname}, #{avatar}, #{highScore}, #{pwd},
		#{gameData}, now(), now())
	</insert>

	<update id="update"
		parameterType="link.swsk33web.miyakogame.dataobject.PlayerDO">
		update `miyakogame_user` set nickname=#{nickname},
		avatar=#{avatar}, high_score=#{highScore}, pwd=#{pwd},
		game_data=#{gameData}, gmt_modified=now() where user_name=#{userName}
	</update>

	<select id="findByUserName" resultMap="playerResultMap">
		select * from
		`miyakogame_user` where user_name=#{userName}
	</select>

	<select id="findByHighScoreInTen" resultMap="rankResultMap">
		select user_name,
		nickname,
		avatar, high_score, @row := @row + 1 as sequence from (select
		@row :=
		0) as rowtemptable, (select * from `miyakogame_user` order by
		high_score desc limit 10) as playerinfo;
	</select>

	<select id="findUserRankByUsername" resultMap="rankResultMap">
		select user_name,
		nickname,
		avatar, high_score, @row := @row + 1 as sequence from (select
		@row :=
		0) as temp, (select * from `miyakogame_user` order by
		high_score desc)
		as playertable where user_name=#{userName}
	</select>

</mapper>