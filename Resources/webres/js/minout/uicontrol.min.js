let currentScoreDom=document.querySelector(".game .topBar .scorePanel .currentScore"),highScoreDom=document.querySelector(".game .topBar .scorePanel .highScore"),levelDom=document.querySelector(".game .topBar .level"),healthDom=document.querySelector(".game .topBar .health .t"),propsDom=document.querySelector(".game .topBar .props"),weaponDom=document.querySelector(".game .topBar .weapon"),gameBackground=document.querySelector(".game .gameBg"),gameTopBar=document.querySelector(".game .topBar"),succeedPage=document.querySelector(".succeed"),failedPage=document.querySelector(".failed"),startPage=document.querySelector(".start"),pausePage=document.querySelector(".pause"),loadingPage=document.querySelector(".loading"),rankPage=document.querySelector(".leaderboard"),processBar=document.querySelector(".loading .processBar .processValue"),processNum=document.querySelector(".loading .processNum"),notSupportPage=document.querySelector(".notsupport"),helpPage=document.querySelector(".help"),shopPage=document.querySelector(".shop"),startPageBtn=document.querySelector(".start ul").children;function operateStartPage(isVisible){if(isVisible)startPage.children[0].style.display="flex",startPage.children[1].style.display="inline",startPage.style.borderRight="none",startPage.style.width="100%",readData()||health<0?(startPageBtn[0].style.color="gray",startPageBtn[0].removeEventListener("click",continueGame)):(startPageBtn[0].style.color="#ff5500",startPageBtn[0].addEventListener("click",continueGame)),startPage.style.display="flex";else{let totalMagnification=3570,pageWidth=startPage.offsetWidth,eachMove=pageWidth/totalMagnification,startRate=119,keyFrame=60;startPage.style.borderRight="5px solid #014dff";let fadeControl=setInterval(()=>{pageWidth-=startRate*eachMove,startPage.style.width=pageWidth+"px",startRate-=2,keyFrame--,40==keyFrame&&(startPage.children[0].style.display="none",startPage.children[1].style.display="none"),keyFrame<=0&&(startPage.style.display="none",clearInterval(fadeControl))},16)}}function operateTopBarContent(isVisible){if(isVisible)for(let i=0;i<gameTopBar.children.length;i++)gameTopBar.children[i].style.display="flex";else for(let i=0;i<gameTopBar.children.length;i++)gameTopBar.children[i].style.display="none"}function operateLoadingPage(isVisible){loadingPage.style.display=isVisible?"flex":"none"}function setLoadingBar(value){let originValue=processNum.innerHTML.substring(8,processNum.innerHTML.indexOf("%")),distance=value-parseFloat(originValue);if(distance>0){let section,sectionValue=distance/169,eachLoadSection=25,loadInterval=setInterval((function(){originValue=parseFloat(originValue)+eachLoadSection*sectionValue,processBar.style.width=originValue+"%",processNum.innerHTML="process "+originValue.toFixed(2)+"%",eachLoadSection-=2,eachLoadSection<0&&clearInterval(loadInterval)}),16)}}function operateNotSupportPage(isVisible,msg){isVisible?(notSupportPage.style.display="flex",notSupportPage.children[1].innerHTML=msg):notSupportPage.style.display="none"}function opreateFailedPage(isVisible){isVisible?(failedPage.style.display="flex",document.querySelector(".failedAudio-"+genRandom(1,3)).play()):failedPage.style.display="none"}function operateSuccessPage(isVisible){isVisible?(succeedPage.style.display="flex",document.querySelector(".succeedAduio-"+genRandom(1,2)).play()):succeedPage.style.display="none"}function operatePausePage(isVisible){pausePage.style.display=isVisible?"flex":"none"}function opreateHelpPage(isVisible){helpPage.style.display=isVisible?"block":"none"}function operateShopPage(isVisible){if(isVisible){mouseMoveDropDotControl(!1),mouseClickLineControl(!1),currentDOM.innerText="当前有"+currentScore+"分";for(let i=0;i<propsList.length;i++){let eachPropsItem=document.createElement("li"),img=document.createElement("img");img.src=propsList[i].img;let descriptionDialog=document.createElement("div");descriptionDialog.style.position="absolute",descriptionDialog.style.backgroundColor="white",descriptionDialog.style.borderStyle="solid",descriptionDialog.style.borderWidth="1.5px",descriptionDialog.style.borderRadius="3px",descriptionDialog.innerText=propsList[i].description;let name=document.createElement("div");name.innerText=propsList[i].name+" "+propsList[i].price,name.addEventListener("mouseenter",e=>{descriptionDialog.style.left=e.pageX-descriptionDialog.offsetWidth+"px",descriptionDialog.style.top=e.pageY-36+"px",document.querySelector("body").appendChild(descriptionDialog)}),name.addEventListener("mouseleave",()=>{descriptionDialog.remove()});let count=document.createElement("div");count.style.color="purple",count.innerText="0";let buttons=document.createElement("div");buttons.className="countButtonBox";let addOne=document.createElement("div");addOne.addEventListener("click",()=>{eachPropsSelectCount[i]++,count.innerText=eachPropsSelectCount[i],totalPrice+=propsList[i].price,totalDOM.innerText="共消耗"+totalPrice+"积分"}),addOne.innerText="+1";let addTen=document.createElement("div");addTen.addEventListener("click",()=>{eachPropsSelectCount[i]=eachPropsSelectCount[i]+10,count.innerText=eachPropsSelectCount[i],totalPrice+=10*propsList[i].price,totalDOM.innerText="共消耗"+totalPrice+"积分"}),addTen.innerText="+10";let rmOne=document.createElement("div");rmOne.addEventListener("click",()=>{eachPropsSelectCount[i]>0&&(eachPropsSelectCount[i]--,count.innerText=eachPropsSelectCount[i],totalPrice-=propsList[i].price,totalDOM.innerText="共消耗"+totalPrice+"积分")}),rmOne.innerText="-1";let rmTen=document.createElement("div");rmTen.addEventListener("click",()=>{if(eachPropsSelectCount[i]>=10)eachPropsSelectCount[i]=eachPropsSelectCount[i]-10,count.innerText=eachPropsSelectCount[i],totalPrice-=10*propsList[i].price;else if(eachPropsSelectCount[i]>0&&eachPropsSelectCount[i]<10){let currentCount=eachPropsSelectCount[i];eachPropsSelectCount[i]=0,count.innerText=eachPropsSelectCount[i],totalPrice-=currentCount*propsList[i].price}totalDOM.innerText="共消耗"+totalPrice+"积分"}),rmTen.innerText="-10",buttons.appendChild(addOne),buttons.appendChild(addTen),buttons.appendChild(rmOne),buttons.appendChild(rmTen),eachPropsItem.appendChild(img),eachPropsItem.appendChild(name),eachPropsItem.appendChild(count),eachPropsItem.appendChild(buttons),propsShopList.appendChild(eachPropsItem),eachPropsSelectCount.push(0)}eachWeaponSelectedCount.push(0);for(let i=1;i<weaponList.length;i++){let eachWeaponItem=document.createElement("li"),img=document.createElement("img");img.src=weaponList[i].texture;let name=document.createElement("div");name.innerText=weaponList[i].name+" "+weaponList[i].price;let count=document.createElement("div");count.style.color="purple",count.innerText="0";let buttons=document.createElement("div");buttons.className="countButtonBox";let addOne=document.createElement("div");addOne.addEventListener("click",()=>{eachWeaponSelectedCount[i]++,count.innerText=eachWeaponSelectedCount[i],totalPrice+=weaponList[i].price,totalDOM.innerText="共消耗"+totalPrice+"积分"}),addOne.innerText="+1";let addTen=document.createElement("div");addTen.addEventListener("click",()=>{eachWeaponSelectedCount[i]=eachWeaponSelectedCount[i]+10,count.innerText=eachWeaponSelectedCount[i],totalPrice+=10*weaponList[i].price,totalDOM.innerText="共消耗"+totalPrice+"积分"}),addTen.innerText="+10";let rmOne=document.createElement("div");rmOne.addEventListener("click",()=>{eachWeaponSelectedCount[i]>0&&(eachWeaponSelectedCount[i]--,count.innerText=eachWeaponSelectedCount[i],totalPrice-=weaponList[i].price,totalDOM.innerText="共消耗"+totalPrice+"积分")}),rmOne.innerText="-1";let rmTen=document.createElement("div");rmTen.addEventListener("click",()=>{if(eachWeaponSelectedCount[i]>=10)eachWeaponSelectedCount[i]=eachWeaponSelectedCount[i]-10,count.innerText=eachWeaponSelectedCount[i],totalPrice-=10*weaponList[i].price;else if(eachWeaponSelectedCount[i]>0&&eachWeaponSelectedCount[i]<10){let currentCount=eachWeaponSelectedCount[i];eachWeaponSelectedCount[i]=0,count.innerText=eachWeaponSelectedCount[i],totalPrice-=currentCount*weaponList[i].price}totalDOM.innerText="共消耗"+totalPrice+"积分"}),rmTen.innerText="-10",buttons.appendChild(addOne),buttons.appendChild(addTen),buttons.appendChild(rmOne),buttons.appendChild(rmTen),eachWeaponItem.appendChild(img),eachWeaponItem.appendChild(name),eachWeaponItem.appendChild(count),eachWeaponItem.appendChild(buttons),weaponShopList.appendChild(eachWeaponItem),eachWeaponSelectedCount.push(0)}shopPage.style.display="flex"}else mouseMoveDropDotControl(!0),mouseClickLineControl(!0),totalPrice=0,eachPropsSelectCount=[],eachWeaponSelectedCount=[],totalDOM.innerText="共消耗0积分",propsShopList.innerHTML="",weaponShopList.innerHTML="",shopPage.style.display="none"}function operateUserInfoUpdatePage(isVisible){isVisible?(userInfoPageDOM.style.display="flex",previewImg.src=onlineUserData.avatar,updateNickNameInput.value=onlineUserData.nickname,updateEmailInput.value=onlineUserData.email):userInfoPageDOM.style.display="none"}function operateRankPage(isVisible){let loadingTip=document.querySelector(".leaderboard .requesting"),totalRankList=document.querySelector(".leaderboard .frame .total .rank"),personalRank=document.querySelector(".leaderboard .frame .me .content").children;if(isVisible){let rankArray;rankPage.style.display="flex",loadingTip.style.display="flex",fetch("/miyakogame/api/player/rankten").then(response=>response.json()).then(result=>{if(result.success){rankArray=result.data;for(let i=0;i<rankArray.length;i++){let getUserRank=rankArray[i],eachRankInfo=document.createElement("li"),eachUserInfo=document.createElement("div");eachUserInfo.className="nickname";let userAvatar=document.createElement("img");userAvatar.src=getUserRank.avatar;let userNameText=document.createElement("div");userNameText.className="text",userNameText.innerText=getUserRank.nickname,getUserRank.userName==onlineUserData.userName&&(userNameText.style.color="blue"),eachUserInfo.appendChild(userAvatar),eachUserInfo.appendChild(userNameText);let scoreText=document.createElement("div");scoreText.className="score",scoreText.innerText=getUserRank.highScore;let rankText=document.createElement("div");rankText.className="rank",rankText.innerText=getUserRank.sequence,eachRankInfo.appendChild(eachUserInfo),eachRankInfo.appendChild(scoreText),eachRankInfo.appendChild(rankText),totalRankList.appendChild(eachRankInfo)}loadingTip.style.display="none"}else loadingTip.style.display="none",showTipFrame("获取全服排名失败！请检查网络！",null,".tip-false")}),isUserLogin&&fetch("/miyakogame/api/player/playerank?id="+onlineUserData.id).then(response=>response.json()).then(result=>{result.success?(personalRank[0].children[0].src=onlineUserData.avatar,personalRank[0].children[1].innerText=onlineUserData.nickname,personalRank[1].innerText=onlineUserData.highScore,personalRank[2].innerText=result.data.sequence,loadingTip.style.display="none"):(loadingTip.style.display="none",showTipFrame("获取个人排名失败！请检查网络！",null,".tip-false"))})}else totalRankList.innerHTML="",rankPage.style.display="none"}function operateUserDelTip(isVisible){delUserTip.style.display=isVisible?"flex":"none"}function enemyFadeEffect(enemyObject){enemyObject.isEaten=!0,addScore(enemyObject.score);let currentKeyFrame=20,totalKeyFrame=currentKeyFrame,sizeRatio=1,deg=0,showScore=document.createElement("div"),showScoreTransparency=1,textMoveRatio=5;showScore.innerText="+"+enemyObject.score,showScore.style.position="absolute",showScore.style.fontSize="24px",showScore.style.left=enemyObject.dom.offsetLeft-enemyObject.dom.offsetWidth/2+"px",showScore.style.top=enemyObject.dom.offsetTop+"px",document.querySelector("body").appendChild(showScore);let effectControl=setInterval(()=>{enemyObject.dom.style.transform="scale("+sizeRatio.toFixed(2)+") rotate("+deg+"deg)",showScore.style.color="rgba(0, 0, 0,"+showScoreTransparency+")",showScore.style.top=showScore.offsetTop-textMoveRatio+"px",sizeRatio-=1/totalKeyFrame,deg+=90/totalKeyFrame,showScoreTransparency-=1/totalKeyFrame,textMoveRatio-=currentKeyFrame<=16?textMoveRatio/16:1,currentKeyFrame--,currentKeyFrame<=0&&(enemyObject.dom.style.display="none",showScore.remove(),clearInterval(effectControl))},16)}