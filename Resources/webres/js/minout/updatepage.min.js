let userInfoPageDOM=document.querySelector(".userInfoUpdate"),uploadInputImg=document.querySelector(".userInfoUpdate .frame .formBody .avatar .file input"),updateNickNameInput=document.querySelector(".userInfoUpdate .frame .formBody .nickname input"),updatePwdInput=document.querySelector(".userInfoUpdate .frame .formBody .pwd input"),previewImg=document.querySelector(".userInfoUpdate .frame .formBody .avatar .preview"),userInfoButtons=document.querySelector(".userInfoUpdate .buttons").children,updateRequestTip=document.querySelector(".userInfoUpdate .requesting");uploadInputImg.onchange=()=>{let reader=new FileReader;reader.onload=()=>{previewImg.src=reader.result},reader.readAsDataURL(uploadInputImg.files[0])},userInfoButtons[0].addEventListener("click",()=>{updateRequestTip.style.display="flex";let data={userName:onlineUserData.userName,nickname:updateNickNameInput.value,pwd:updatePwdInput.value};if(uploadInputImg.files.length>0){let imgData=new FormData;imgData.append("img",uploadInputImg.files[0]),fetch("/miyakogame/api/avatar/upload",{method:"POST",body:imgData}).then(response=>response.json()).then(result=>{if(result.success){data.avatar="/miyakogame/api/avatar/"+result.data.id;let dataStr=JSON.stringify(data);fetch("/miyakogame/api/update",{method:"POST",body:dataStr,headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("更新用户信息成功！3s后刷新页面...",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("更新用户信息失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}else showTipFrame("更新用户信息失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}else{let dataStr=JSON.stringify(data);fetch("/miyakogame/api/update",{method:"POST",body:dataStr,headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("更新用户信息成功！3s后刷新页面...",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("更新用户信息失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}}),userInfoButtons[1].addEventListener("click",()=>{operateUserInfoUpdatePage(!1)});