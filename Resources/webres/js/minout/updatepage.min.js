let userInfoPageDOM=document.querySelector(".userInfoUpdate"),uploadInputImg=document.querySelector(".userInfoUpdate .frame .formBody .avatar .file input"),updateNickNameInput=document.querySelector(".userInfoUpdate .frame .formBody .nickname input"),updateEmailInput=document.querySelector(".userInfoUpdate .frame .formBody .email input"),updatePwdInput=document.querySelector(".userInfoUpdate .frame .formBody .pwd input"),previewImg=document.querySelector(".userInfoUpdate .frame .formBody .avatar .preview"),userInfoButtons=document.querySelector(".userInfoUpdate .buttons").children,updateRequestTip=document.querySelector(".userInfoUpdate .requesting"),delUserBtn=document.querySelector(".userInfoUpdate .frame .del"),delUserTip=document.querySelector(".userInfoUpdate .delUserTip"),delUserPwd=document.querySelector(".userInfoUpdate .delUserTip input"),delUserTipBtn=document.querySelector(".userInfoUpdate .delUserTip .buttons").children;uploadInputImg.onchange=()=>{let reader=new FileReader;reader.onload=()=>{previewImg.src=reader.result},reader.readAsDataURL(uploadInputImg.files[0])},userInfoButtons[0].addEventListener("click",()=>{updateRequestTip.style.display="flex";let data={id:onlineUserData.id,nickname:updateNickNameInput.value,pwd:updatePwdInput.value,email:updateEmailInput.value};if(uploadInputImg.files.length>0){if(0==uploadInputImg.files[0].size)return showTipFrame("更新信息失败，原因：不能上传空文件！",null,".tip-false"),updateRequestTip.style.display="none",!1;if(uploadInputImg.files[0].size>2097152)return showTipFrame("更新信息失败，原因：头像文件大小必须小于2MB！",null,".tip-false"),updateRequestTip.style.display="none",!1;let fileType=uploadInputImg.files[0].name.substring(uploadInputImg.files[0].name.lastIndexOf(".")+1);if(fileType=fileType.toLowerCase(),"jpg"!=fileType&&"jpeg"!=fileType&&"png"!=fileType&&"gif"!=fileType)return showTipFrame("更新信息失败，原因：头像文件必须是jpg,jpeg,png或者gif格式！",null,".tip-false"),updateRequestTip.style.display="none",!1;let imgData=new FormData;imgData.append("img",uploadInputImg.files[0]),fetch("/miyakogame/api/avatar/upload",{method:"POST",body:imgData}).then(response=>response.json()).then(result=>{if(result.success){data.avatar=result.data;let dataStr=JSON.stringify(data);fetch("/miyakogame/api/update",{method:"POST",body:dataStr,headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("更新信息成功！3s后刷新页面...",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("更新信息失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}else showTipFrame("更新信息失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}else{let dataStr=JSON.stringify(data);fetch("/miyakogame/api/update",{method:"POST",body:dataStr,headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("更新信息成功！3s后刷新页面...",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("更新信息失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}}),userInfoButtons[1].addEventListener("click",()=>{operateUserInfoUpdatePage(!1)}),delUserBtn.addEventListener("click",()=>{operateUserDelTip(!0)}),delUserTipBtn[0].addEventListener("click",()=>{updateRequestTip.style.display="flex";let data={id:onlineUserData.id,pwd:delUserPwd.value};fetch("/miyakogame/api/delete",{method:"POST",body:JSON.stringify(data),headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("注销账户成功！3s后刷新页面...",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("注销账户失败，原因："+result.message,null,".tip-false"),updateRequestTip.style.display="none"})}),delUserTipBtn[1].addEventListener("click",()=>{operateUserDelTip(!1)});