let level,health,highScore=0,currentScore=0,propsCount=[],weaponCount=[],isUserLogin=!1,onlineUserData={id:null,userName:null,nickname:null,email:null,avatar:null,highScore:null,gameData:null},userDataDOM=document.querySelector(".userLoginData").children;function addScore(score){currentScore=parseInt(currentScore)+score,currentScore>highScore&&(highScore=currentScore),refreshDom()}function saveData(){let data={level:level,health:health,highScore:highScore,currentScore:currentScore,propsCount:propsCount,weaponCount:weaponCount},dataStr=JSON.stringify(data);window.localStorage.setItem("data",dataStr),isUserLogin&&(onlineUserData.highScore=highScore,onlineUserData.gameData=dataStr,fetch("/miyakogame/api/update",{method:"POST",body:JSON.stringify(onlineUserData),headers:{"content-type":"application/json"}})),refreshDom()}function readData(){let isNewGame=!1,data;if(data=isUserLogin?JSON.parse(onlineUserData.gameData):JSON.parse(window.localStorage.getItem("data")),null==data||0==data.highScore)resetData(),isNewGame=!0;else{if(level=data.level,health=data.health,highScore=data.highScore,currentScore=data.currentScore,propsCount=data.propsCount,weaponCount=data.weaponCount,propsCount.length<propsList.length){let n=propsList.length-propsCount.length;for(let i=0;i<n;i++)propsCount.push(1)}if(weaponCount.length<weaponList.length){let n=weaponList.length-weaponCount.length;for(let i=0;i<n;i++)weaponCount.push(10)}saveData()}return isNewGame}function resetData(){currentScore=0,health=3,level=1,propsCount=[],weaponCount=[];for(let i=0;i<weaponList.length;i++)0==i?weaponCount.push(-1):weaponCount.push(10);for(let i=0;i<propsList.length;i++)propsCount.push(1);saveData(),refreshDom()}function refreshDom(){currentScoreDom.innerText="积分："+currentScore,highScoreDom.innerText="最高分数："+highScore,healthDom.innerText="x"+health,levelDom.innerText="第"+level+"关",weaponDom.children[0].innerText=weaponList[currentWeaponIndex].name,weaponDom.children[1].src=weaponList[currentWeaponIndex].texture,0==currentWeaponIndex?weaponDom.children[2].innerText="x无限":weaponDom.children[2].innerText="x"+weaponCount[currentWeaponIndex],propsDom.children[0].innerText=propsList[currentPropsIndex].name,propsDom.children[1].src=propsList[currentPropsIndex].img,propsDom.children[2].innerText="x"+propsCount[currentPropsIndex]}function genRandom(min,max){return Math.floor(Math.random()*(max-min+1)+min)}"true"==userDataDOM[0].innerText?(isUserLogin=!0,onlineUserData.id=parseInt(userDataDOM[1].innerText),onlineUserData.userName=userDataDOM[2].innerText,onlineUserData.nickname=userDataDOM[3].innerText,onlineUserData.email=userDataDOM[4].innerText,onlineUserData.avatar=userDataDOM[5].innerText,onlineUserData.highScore=parseInt(userDataDOM[6].innerText),onlineUserData.gameData=userDataDOM[7].innerText):showTipFrame("登录以存储游戏进度至云端不再丢失，并加入排行榜。");