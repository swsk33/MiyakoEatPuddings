let loginUserNameInput=document.querySelector(".formbody .userName input"),loginPwdInput=document.querySelector(".formbody .pwd input"),loginRequestTip=document.querySelector(".requesting"),forgetBtn=document.querySelector(".formbody .forget"),queryUser=document.querySelector(".forget-queryEmail"),queryUserLoadingTip=queryUser.querySelector(".requesting"),queryEmailInput=document.querySelector(".forget-queryEmail .frame .query input"),queryEmailBtn=document.querySelector(".forget-queryEmail .frame .query .queryRequest"),queryEmailList=document.querySelector(".forget-queryEmail .frame .box ul"),queryUserCloseBtn=document.querySelector(".forget-queryEmail .frame .close"),resetPwdFrame=document.querySelector(".forget-verifyAndReset"),resetLoadingTip=resetPwdFrame.querySelector(".requesting"),resetPwdMainFrame=resetPwdFrame.querySelector(".frame"),resetPlayerInfo=resetPwdMainFrame.querySelector(".userInfo"),verifyCode=resetPwdMainFrame.querySelector(".code input"),sendCodeBtn=resetPwdMainFrame.querySelector(".code .send"),newPwd=resetPwdMainFrame.querySelector(".pwd input"),resetOk=resetPwdMainFrame.querySelector(".buttons .ok"),resetCancel=resetPwdMainFrame.querySelector(".buttons .cancel"),resetPlayerData;function sendVerifyCode(){resetLoadingTip.style.display="flex",fetch("/miyakogame/api/mail/sendcode?id="+resetPlayerData.id+"&email="+resetPlayerData.email+"&type=PASSWORD_RESET").then(response=>response.json()).then(result=>{if(result.success){sendCodeBtn.removeEventListener("click",sendVerifyCode);let timeRemain=60;sendCodeBtn.style.color="gray",sendCodeBtn.innerText=timeRemain+"s重新发送";let sendCodeInterval=setInterval(()=>{timeRemain--,sendCodeBtn.innerText=timeRemain+"s重新发送",timeRemain<=0&&(sendCodeBtn.style.color="black",sendCodeBtn.innerText="发送验证码",sendCodeBtn.addEventListener("click",sendVerifyCode),clearInterval(sendCodeInterval))},1e3)}else showTipFrame("发送验证码失败！原因："+result.message,null,".tip-false");resetLoadingTip.style.display="none"})}document.querySelector(".formbody .ok").addEventListener("click",()=>{let data={userName:loginUserNameInput.value,pwd:loginPwdInput.value},dataString=JSON.stringify(data);loginRequestTip.style.display="flex",fetch("/miyakogame/api/player/login",{method:"POST",body:dataString,headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("登录成功！3s后跳转至游戏界面。",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("登录失败！原因："+result.message,null,".tip-false"),loginRequestTip.style.display="none"})}),forgetBtn.addEventListener("click",()=>{queryUser.style.display="flex"}),queryEmailBtn.addEventListener("click",()=>{queryEmailList.innerHTML="",queryUserLoadingTip.style.display="flex",fetch("/miyakogame/api/player/findbyemail?email="+queryEmailInput.value).then(response=>response.json()).then(result=>{if(result.success)for(let eachPlayer of result.data){let liDOM=document.createElement("li"),imgBox=document.createElement("div");imgBox.className="imgBox";let imgDOM=document.createElement("img");imgDOM.src=eachPlayer.avatar,imgBox.appendChild(imgDOM);let usernameDOM=document.createElement("div");usernameDOM.className="username",usernameDOM.innerText=eachPlayer.userName;let nicknameDOM=document.createElement("div");nicknameDOM.className="nickname",nicknameDOM.innerText=eachPlayer.nickname;let btnDOM=document.createElement("div");btnDOM.className="div-btn",btnDOM.innerText="找回",btnDOM.addEventListener("click",()=>{resetPlayerData=eachPlayer,resetPwdFrame.style.display="flex",resetPlayerInfo.innerText="找回账号："+resetPlayerData.userName}),liDOM.appendChild(imgBox),liDOM.appendChild(usernameDOM),liDOM.appendChild(nicknameDOM),liDOM.appendChild(btnDOM),queryEmailList.appendChild(liDOM)}else showTipFrame("查询失败！原因："+result.message,null,".tip-false");queryUserLoadingTip.style.display="none"})}),queryUserCloseBtn.addEventListener("click",()=>{queryUser.style.display="none",queryEmailList.innerHTML=""}),resetCancel.addEventListener("click",()=>{resetPwdFrame.style.display="none",resetPlayerData=null}),sendCodeBtn.addEventListener("click",sendVerifyCode),resetOk.addEventListener("click",()=>{if(resetLoadingTip.style.display="flex",resetPlayerData.pwd=newPwd.value,""===verifyCode.value)return showTipFrame("重置密码失败！原因：验证码不能为空！",null,".tip-false"),void(resetLoadingTip.style.display="none");fetch("/miyakogame/api/player/resetpwd?code="+verifyCode.value,{method:"POST",body:JSON.stringify(resetPlayerData),headers:{"content-type":"application/json"}}).then(response=>response.json()).then(result=>{result.success?(showTipFrame("重置密码成功！3s后跳转至游戏界面。",null,".tip-true"),setTimeout(()=>{window.location.pathname="/miyakogame"},3e3)):showTipFrame("重置密码失败！原因："+result.message,null,".tip-false"),resetLoadingTip.style.display="none"})}),mouseMoveDropDotControl(!0),mouseClickLineControl(!0);