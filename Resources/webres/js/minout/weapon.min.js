let weaponList=[];const colors=["#ff0f26","#ff7d0f","#ffe72e","#b2ff2e","#3cff2e","#2effd3","#0700ff","#c000ff"];function Weapon(name,description,price,texture,interval,soundClassName,shooting,flying,hitTrigger){this.name=name,this.description=description,this.price=price,this.texture=texture,this.interval=interval,this.soundClassName=soundClassName,this.shooting=shooting,this.flying=flying,this.hitTrigger=hitTrigger}function generateImageBulletDOM(src,x,y){let imgBulletDom=document.createElement("img");return imgBulletDom.src=src,imgBulletDom.style.position="absolute",imgBulletDom.style.left=x+"px",imgBulletDom.style.top=y+"px",gameBackground.appendChild(imgBulletDom),imgBulletDom}function domFlyX(dom,velocity){let x=dom.offsetLeft;x+=velocity,dom.style.left=x+"px"}function domFlyY(dom,velocity){let y=dom.offsetTop;y+=velocity,dom.style.top=y+"px"}function domFly(dom,velocity,direction){let arcDirection=direction/180*Math.PI,x=dom.offsetLeft,y=dom.offsetTop;x+=Math.cos(arcDirection)*velocity,y-=Math.sin(arcDirection)*velocity,dom.style.left=x+"px",dom.style.top=y+"px"}let defaultWeapon=new Weapon("常规鬼火","最普通的鬼火武器，宫子借助它吃布丁，冷却0.6s",0,"/img/bullets/bullet.png",600,".fireAudio",(x,y)=>generateImageBulletDOM(defaultWeapon.texture,x,y),(bulletDOM,enemies)=>{domFlyX(bulletDOM,8)},(bulletDOM,enemy,enemies)=>{document.querySelector(".scoreAduio").play(),enemyFadeEffect(enemy),bulletDOM.remove()}),penetrateWildfire=new Weapon("穿透鬼火","可以穿透水平方向上的布丁，冷却1.5s",10,"/img/bullets/bullet-penetrate.png",1500,".fire-penetrateAudio",(x,y)=>generateImageBulletDOM(penetrateWildfire.texture,x,y),(bulletDOM,enemies)=>{domFlyX(bulletDOM,9)},(bulletDOM,enemy,enemies)=>{document.querySelector(".scoreAduio").play(),enemyFadeEffect(enemy)}),boomWildfire=new Weapon("爆裂之火","遇到布丁会爆炸的鬼火，一次吃掉多个布丁，冷却1.25s",15,"/img/bullets/bullet-boom.gif",1250,".fire-boomAudio",(x,y)=>generateImageBulletDOM(boomWildfire.texture,x,y),(bulletDOM,enemies)=>{domFlyX(bulletDOM,7)},(bulletDOM,enemy,enemies)=>{document.querySelector(".score-boomAudio").play();let bulletAtX=bulletDOM.offsetLeft-bulletDOM.offsetWidth/2,bulletAtY=bulletDOM.offsetTop-bulletDOM.offsetHeight/2,radius=1,radiusGrowth=5,color=colors[genRandom(0,colors.length-1)],shockWave=document.createElement("div");shockWave.style.position="absolute",shockWave.style.left=bulletAtX+"px",shockWave.style.top=bulletAtY+"px",shockWave.style.borderColor=color,shockWave.style.borderRadius="50%",shockWave.style.borderStyle="solid",shockWave.style.borderWidth="5px",bulletDOM.remove(),gameBackground.appendChild(shockWave);let keyFrame=42,waveControl=setInterval(()=>{shockWave.style.width=radius+"px",shockWave.style.height=radius+"px",shockWave.style.left=bulletAtX-radius/2+"px",shockWave.style.top=bulletAtY-radius/2+"px",shockWave.offsetLeft+radius+radiusGrowth/2<gameBackground.offsetWidth&&shockWave.offsetTop+radius+radiusGrowth/2<gameBackground.offsetHeight&&(radius+=radiusGrowth);for(let i=0;i<enemies.length;i++)if(!enemies[i].isEaten){let criteria1=shockWave.offsetTop+shockWave.offsetHeight>=enemies[i].dom.offsetTop&&shockWave.offsetLeft+shockWave.offsetWidth>=enemies[i].dom.offsetLeft,criteria2=shockWave.offsetTop<=enemies[i].dom.offsetTop+enemies[i].dom.offsetHeight&&shockWave.offsetLeft<=enemies[i].dom.offsetLeft+enemies[i].dom.offsetWidth,criteriaTotal;criteria1&&criteria2&&enemyFadeEffect(enemies[i])}keyFrame--,keyFrame<=12&&radiusGrowth>0&&radiusGrowth--,keyFrame<=0&&(shockWave.remove(),clearInterval(waveControl))},16)}),scatterMagic=new Weapon("散布式魔法","一次发射8个魔法球，射角分散，冷却2s",20,"/img/bullets/scatter-icon.png",2e3,".fire-scatterAudio",(x,y)=>{let doms=[],count=8,shootControl=setInterval(()=>{let direction=genRandom(-20,20),startAtY=y+genRandom(-5,5),color=colors[genRandom(0,dotColors.length-1)],eachDot=document.createElement("div");eachDot.style.position="absolute",eachDot.style.width="3px",eachDot.style.height="3px",eachDot.style.borderRadius="50%",eachDot.style.backgroundColor=color,eachDot.style.boxShadow="0px 0px 4px 5px "+color,eachDot.style.left=x+"px",eachDot.style.top=startAtY+"px",eachDot.flydirect=direction,gameBackground.appendChild(eachDot),doms.push(eachDot),count--,count<=0&&clearInterval(shootControl)},60);return doms},(bulletDOM,enemies)=>{for(let i=0;i<bulletDOM.length;i++)domFly(bulletDOM[i],8,bulletDOM[i].flydirect)},(bulletDOM,enemy,enemies)=>{document.querySelector(".scoreAduio").play(),enemyFadeEffect(enemy),bulletDOM.remove()}),bounceMagic=new Weapon("弹弹魔法","遇到上下边界会发生反弹的魔法星星，只不过射击角度有点随机...冷却0.3s",5,"/img/bullets/bounce-icon.png",300,".fire-bounce-shootAudio",(x,y)=>{let direction=genRandom(-60,60),dom=generateImageBulletDOM("/img/bullets/bounce-"+genRandom(1,2)+".png",x,y);return dom.flydirect=direction,dom},(bulletDOM,enemies)=>{let v=7;(bulletDOM.offsetTop-7<=0||bulletDOM.offsetTop+7+bulletDOM.offsetHeight>=gameBackground.offsetHeight)&&(bulletDOM.flydirect=-bulletDOM.flydirect,document.querySelector(".fire-bounce-reflectAudio").play()),domFly(bulletDOM,7,bulletDOM.flydirect)},(bulletDOM,enemy,enemies)=>{document.querySelector(".scoreAduio").play(),enemyFadeEffect(enemy),bulletDOM.remove()}),traceBall=new Weapon("追踪光球","发射后能够自动追踪布丁的魔法光球，冷却1.1s",12,"/img/bullets/trace.png",1100,".fire-traceAudio",(x,y)=>{let dom=generateImageBulletDOM(traceBall.texture,x,y);return dom.flydirect=0,dom.targetEnemy=null,dom},(bulletDOM,enemies)=>{if(null==bulletDOM.targetEnemy||bulletDOM.targetEnemy.isEaten)for(let enemy of enemies)if(!enemy.isEaten){bulletDOM.targetEnemy=enemy;break}let v=8,color=colors[genRandom(0,colors.length-1)],dotRadius=Math.random();dotRadius<.5&&(dotRadius+=1);let dot=document.createElement("div"),dotFlydirect;if(dot.style.position="absolute",dot.style.width=dotRadius+"px",dot.style.height=dotRadius+"px",dot.style.borderRadius="50%",dot.style.backgroundColor=color,dot.style.boxShadow="0px 0px 3.5px 2px "+color,dot.style.left=bulletDOM.offsetLeft+bulletDOM.offsetWidth/2+"px",dot.style.top=bulletDOM.offsetTop+bulletDOM.offsetHeight/2+genRandom(-2,2)+"px",dot.style.transitionProperty="left, top",dot.style.transitionDuration="1s",dot.style.transitionTimingFunction="ease-out",gameBackground.appendChild(dot),dotFlydirect=Math.random()<.5?genRandom(100,135):genRandom(225,260),domFly(dot,25,dotFlydirect),setTimeout(()=>{dot.remove()},350),null==bulletDOM.targetEnemy||bulletDOM.targetEnemy.isEaten)domFly(bulletDOM,8,bulletDOM.flydirect);else{let targetX=bulletDOM.targetEnemy.dom.offsetLeft+bulletDOM.targetEnemy.dom.offsetWidth/2,targetY=bulletDOM.targetEnemy.dom.offsetTop+bulletDOM.targetEnemy.dom.offsetHeight/2,xDistance=targetX-(bulletDOM.offsetLeft+bulletDOM.offsetWidth/2),yDistance=bulletDOM.offsetTop+bulletDOM.offsetHeight/2-targetY,direction;domFly(bulletDOM,8,Math.atan2(yDistance,xDistance)/Math.PI*180)}},(bulletDOM,enemy,enemies)=>{document.querySelector(".scoreAduio").play(),enemyFadeEffect(enemy),bulletDOM.remove()});weaponList.push(defaultWeapon),weaponList.push(penetrateWildfire),weaponList.push(boomWildfire),weaponList.push(scatterMagic),weaponList.push(bounceMagic),weaponList.push(traceBall);